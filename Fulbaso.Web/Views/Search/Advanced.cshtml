@using Fulbaso.Contract
@using Fulbaso.UI
@using Fulbaso.Common

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Header
{
    <div class="page-header">
        <h1>
            Búsqueda avanzada
        </h1>
    </div>
}

@section StyleSheets
{
    <style>
        #label-tags span { margin: 2px; cursor: pointer; }
        .schedule { display:none; }
    </style>
}

@using (Html.BeginForm("Advanced", "Search", FormMethod.Post, new { @class = "form-horizontal" }))
{
    <fieldset>
        <div class="control-group">
            <label class="control-label" for="searchlocation">Ubicación</label>
            <div class="controls">
                @Html.TextBox("searchlocation", "", new { autocomplete = "off" })
                <span class="help-inline">Busque y seleccione para agregar. Si desea quitar algún item de la búsqueda haga click en él.</span>
            </div>
            <div class="controls">
                <div id="label-tags"></div>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="players">Cantidad de jugadores</label>
            <div class="controls">
                <label class="checkbox inline">
                    @Html.CheckBox("player-5", true) 5
                </label>
                <label class="checkbox inline">
                    @Html.CheckBox("player-6", true) 6
                </label>
                <label class="checkbox inline">
                    @Html.CheckBox("player-7", true) 7
                </label>
                <label class="checkbox inline">
                    @Html.CheckBox("player-8", true) 8
                </label>
                <label class="checkbox inline">
                    @Html.CheckBox("player-9", true) 9
                </label>
                <label class="checkbox inline">
                    @Html.CheckBox("player-10", true) 10
                </label>
                <label class="checkbox inline">
                    @Html.CheckBox("player-11", true) 11
                </label>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="floors">Suelo</label>
            <div class="controls">
                @foreach (var f in (IEnumerable<Fulbaso.Helpers.EntityDataObject>)ViewBag.FloorTypes)
                {
                    <label class="checkbox">
                        @Html.CheckBox("floor-" + f.Id, true)
                        @f
                    </label>
                }
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="moreoptions">Otros</label>
            <div class="controls">
                <label class="checkbox">
                    @Html.CheckBox("indoor")
                    Sólo techadas
                </label>
                <label class="checkbox">
                    @Html.CheckBox("lighted")
                    Sólo iluminadas
                </label>
            </div>
        </div>
        <div class="control-group showschedule">
            <div class="controls">
                <a id="showscheduleoption" class="btn">Buscar por disponibilidad</a>
                <span class="label label-warning">Advertencia</span><span class="help-inline">Si busca por disponibilidad sólo se listaran las canchas que dispongan de esta opción.</span>
            </div>
        </div>
        <div class="control-group schedule">
            <label class="control-label" for="date">Sólo canchas disponibles el día</label>
            <div class="controls">
                @Html.TextBox("date", DateTime.Now.ToShortDateString(), new { autocomplete = "off", @class = "span2" })
            </div>
        </div>
        <div class="control-group schedule">
            <label class="control-label" for="hour">A las</label>
            <div class="controls">
                @Html.DropDownList("hour", new SelectList(Enumerable.Range(0, 24).Select(e => new { Id = e, Text = e + " hs" }).ToList(), "Id", "Text"), "[Seleccione]", new { @class = "span2", })
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Buscar</button>
        </div>
    </fieldset> 
}
<script src="@Url.Content("~/Scripts/jquery-ui-datepicker-es.js")" type="text/javascript"></script>
<script>
    $.datepicker.setDefaults($.datepicker.regional["es"]);
    $(function () {
        $("#showscheduleoption").click(function () {
            $(".schedule").fadeIn();
            $(".showschedule").hide();
        });

        $("#date").datepicker();
        var cache = {}, lastReq;
        var c = 0;
        $("#searchlocation").typeahead({
            source: function (typeahead, query) {
                var term = query;
                if (term in cache) {
                    typeahead.process(cache[term]);
                    return;
                }
                lastReq = $.getJSON('@Url.Action("FindLocation", "Search")', { term: query, }, function (data, status, req) {
                    cache[term] = data;
                    if (req === lastReq) {
                        typeahead.process(data);
                    }
                });
            },
            onselect: function (item) {
                c++
                $("#searchlocation").val("");
                if ($(".label-success[data-location='" + item.value + "']").length == 0)
                {
                    $("#label-tags").append("<span data-location=\"" + item.value + "\" class=\"label label-success\">" + item.value + "<input type=\"hidden\" name=\"location-" + c + "\" value=\"" + item.value + "\"/></span>" + (c % 10 == 0 ? "<br>" : ""));
                    $("[data-location='" + item.value + "']").last().click(function () {
                        $(this).remove();
                    });
                }
                $("#searchlocation").focus();
            }
        });
    });
</script>