@using Fulbaso.Common.Security
@using Fulbaso.Web
@using Fulbaso.Web.Models

@model PlaceModel
           
@{
    ViewBag.FormTitle = Model.Place.Description;
    var keywords = Model.Place.Description + ", " + Model.Place.Location + ", " + Model.Place.Location.Region + ", " + string.Join(", ", Model.Place.CourtsInfo.GroupBy(c => c.CourtType.Description).Select(c => c.Key));
}

@section Header
{
    <div class="page-header">
        <h2>
            @ViewBag.FormTitle
            @if (Request.IsAuthenticated)
            {
                if (Model.IsFavourite)
                {
                    <a id="favourite" class="btn active" title="Votar por esta cancha"><i class="icon-thumbs-up"></i></a>
                }
                else
                {
                    <a id="favourite" class="btn" title="Votar por esta cancha"><i class="icon-thumbs-up"></i></a>
                }
                if (UserAuthentication.IsAdmin())
                {
                    <a href="@Url.Action("Admin", "Home", new { place = Model.Place.Page })" class="btn" title="Administrar">Administrar</a>
                }
            }
        </h2>
    </div>
}

@section StyleSheets
{
    <style>
        .fb_ltr, .fb-comments, .fb-comments iframe[style] { width: 100px !important; }
        .fb-comments > span, #fbcomments, .fb_iframe_widget, .fb_iframe_widget[style], .fb_iframe_widget iframe[style], #fbcomments iframe[style] { width: 100% !important; }
        td, th { padding: 8px; line-height: 18px; text-align: left; vertical-align: top; border-top: 1px solid #DDD; border-left: 1px solid #DDD; white-space: nowrap; }
        tbody tr:hover { background-color: #f5f5f5; }
        td:hover { background-color: #ededed; }
        table { width: 100%; }
        .reserved:hover { background-color: #fdfdde; }
        .selected:hover { background-color: #fdefdf; }
        .paid:hover { background-color: #dcead8; }
        .reserved { background-color: #fcfcca; }
        .selected { background-color: #fddecf; }
        .paid { background-color: #eaffea; }
        .tab-content { overflow: hidden !important; }
        .thumbnail p { margin-top: 10px; }
    </style>
}

@section Metadata
{
    <meta property="og:title" content="@Model.Place.Description" />
    <meta property="og:type" content="place" />
    <meta property="og:image" content="@Url.Content("~/img/sport_soccer.png")" />
    <meta property="og:url" content="@Request.Url.AbsoluteUri" />
    <meta property="og:site_name" content="@Configuration.AppTitle"/>
    <meta name="KEYWORDS" content="@Html.Raw(keywords)" />
}

<div class="tabbable">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#info" data-toggle="tab">Información</a>
        </li>
        @if (Model.HasAdmin)
        {
            <li><a href="#schedule" data-toggle="tab">Disponibilidad</a></li>
        }
        @if (Model.Place.Images.Any())
        {
            <li class="visible-phone"><a href="#images" data-toggle="tab">Imágenes</a></li>
        }
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="info">
            @Html.Partial("General", Model.Place)
        </div>
        <div class="tab-pane" id="images">
            <div class="row-fluid" style="margin-top: 10px;">
                <ul class="thumbnails"></ul>
                    @foreach (var f in Model.Place.Images.OrderByDescending(p => p.InsertDate))
                    {
                        <li class="span4" style="margin-bottom: 10px;">
                            <div class="thumbnail">
                                <img src="@Html.Raw(Url.Content("~/uploaded/" + f.FileName))" alt="@f.Description" />
                                <p>@f.Description</p>
                            </div>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        $(function () {
            $("#favourite").click(function () {
                if ($(this).hasClass("active")) {
                    $(this).removeClass("active");
                    $.post("@Url.Action("DeleteFavourite", "Place")", { favourite: @Model.Place.Id });
                }
                else {
                    $(this).addClass("active");
                    $.post("@Url.Action("AddFavourite", "Place")", { favourite: @Model.Place.Id });
                }
            });
            $(".carousel").carousel({ interval: false });
        });
    </script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    @if (Model.Place.MapUa != null && Model.Place.MapVa != null)
    {
        <script>
            $(function () {
                f.map.initialize("map_canvas", "@Model.Place.MapUa.ToString().Replace(',', '.')", "@Model.Place.MapVa.ToString().Replace(',', '.')");
                f.map.mark("@Html.Raw(Model.Place.Description)", "@Model.Place.MapUa.ToString().Replace(',', '.')", "@Model.Place.MapVa.ToString().Replace(',', '.')");
                f.map.markFrom("@Url.Action("GetNearest", "Place", new { place = @Model.Place.Page })", "@Url.Content("~")img/sport_soccer.png", "@Url.Action("GetNearestLayout", "Place", new { place = Model.Place.Page, description = Model.Place.Description, })");
                f.location.initialize("map_canvas", function (position) {
                    f.map.mark("¡Estás acá! (en un radio de " + position.coords.accuracy + " metros)", position.coords.latitude, position.coords.longitude, "@Url.Content("~")img/user.png");
                });
            });
        </script>
    }
    <script src="@Url.Content("~/Scripts/jquery-ui-datepicker-es.js")" type="text/javascript"></script>
    <script>
        $.datepicker.setDefaults($.datepicker.regional["es"]);
        $(function () {
            $("#current").datepicker();
        });
    </script>
}